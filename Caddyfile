# {
#   on_demand_tls {
#     ask https://mysaas.com/api/allowed-domains
#     interval 2m
#     burst 5
#   }
# }

localhost tinywebapps.com {
  tls {
    on_demand
  }
  rewrite * /admin{uri}
  reverse_proxy replnotes:8080
}

*.tinywebapps.com :80 :443 {
  tls {
    on_demand
  }
  rewrite * /user{uri}
  reverse_proxy replnotes:8080 {
    header_up Host {http.reverse_proxy.upstream.hostport}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Real-IP {http.reverse-proxy.upstream.address}
    header_up X-Forwarded-Proto {http.request.scheme}
    header_up X-Forwarded-Port {http.request.port}
    header_up X-Forwarded-Host {http.request.host}
  }
}