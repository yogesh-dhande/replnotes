export const state = () => ({
  siteOwner: {
    // name: "blog",
    isPremium: false,
    location: "",
    site: {
      title: "Yogesh Dhande",
      description: "Yogesh Dhande's website on REPL Notes"
    },
    photoUrl:
      "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/userPhoto?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=aM23WZLLhtm2be5ILs7fz87JnasUuL3lzvo8TFftwcZBzpvMqq6EgPdkRtfncde3JfRAA%2BsquUY2tW%2FbTd%2F0j61ZWGSdlqd94mZz0HrCRBbwsXUxrAuqHY4IaeRX1xpeVPu1YaFRBtySeCodLN%2F%2BMdhFjT86ObawsUFXQb7Y%2FkE3tFdu6clboIbRheXpWALkcJdV9rumDN7IzS3fLiTi5Yh6qZaGo5x1rWl1Qk4SYj7H50LVaBFdstJSaHP6CFYHXIXX9zNibI4ShRvochhZVOrt8nUMw0vDsAVNwvV0FrsaQSEL4Nz8j6EN%2BW5iGm9sBBBsC9GtUgwdG9OwCZAbFA%3D%3D",
    email: "yogeschkd1988@yahoo.com",
    title: "",
    social: {
      linkedIn: { url: "", label: "LinkedIn" },
      youtube: { label: "Youtube", url: "" },
      twitter: { label: "Twitter", url: "" },
      github: { url: "", label: "Github" }
    },
    pinnedPostId: "64y8yQyTExCWgdVMSLP9",
    posts: [
      {
        created: { seconds: 1617545334, nanoseconds: 609000000 },
        user: {
          displayName: "REPL Notes",
          thumbnailUrl:
            "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/userThumbnail?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=FNPpbSmO%2BEMlNkiUsN16Ld5VRR%2FJhhvTVYJ9vQUQqiRga37M%2BKjg9qrKDOZnOE2KVektdZGvx9QifHe1mIg3ZMFh%2B2RJJ7ohd%2FA3OWwkBk4Vm%2B61I3gHtnFS%2BZ3JrcSLRPpQ5TEGa99Sefr%2FzvcPukfisSKeYHK3NC2%2BpHah%2FNg8yBy6EGhDdtS94f9wiLZjlCVaU5m24prebOwp%2FzM1ax5kfNZ6v5KhHnGa%2BhG4HDKdTP2ydM72cK8leui%2BGxwPL3ayqXczVtkdhpWfgWTZuENMcdfgT7Yv1qfyC%2BlT2iWUwrlMgJsddZIrv52v%2Bi014zKuVH1YpryqJ8Grhrj1LA%3D%3D",
          id: "WmUJgxHnAQP47QShMC6by5tKu8h1",
          name: "blog"
        },
        url: "introduction",
        description: "Learn how to turn Jupyter notebooks into a blog.",
        id: "1NahOOJatvMFMPa48uTa",
        tags: ["REPL Notes"],
        thumbnail:
          "https://firebasestorage.googleapis.com/v0/b/staging-2cacb.appspot.com/o/users%2FWmUJgxHnAQP47QShMC6by5tKu8h1%2Fposts%2F1NahOOJatvMFMPa48uTa%2Fthumbnail?alt=media&token=5b396aa1-9207-44ad-881b-35817a38f694",
        title: "Introducing REPL Notes - start blogging with Jupyter notebooks",
        file: {
          size: 1068571,
          url:
            "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/posts/1NahOOJatvMFMPa48uTa/post.ipynb?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=Gy%2B0FAFN1zrxJwVwDzHZhM8AypK6%2Bu9ayToM5iLLvHygDPl7%2BCZJL%2BUEqRTB6EAQcKiaOkqpz3vd7Ig59HB%2BMm%2BJA8%2BzVZ2vUcOcEYWgxroiL3HzzOZCc9W76%2FWC%2F3HdUrxNUq%2BgJNkDIw4BdwlItN6HyXIUYS84nECsYw%2FNAooeZWHxnnJasMj4NFA93mk98pxE5zwjaKyvK596TnzJgC9cwKJkq860UCaOILFYRkgJ7DDIZYsFaLxInkFKazsNE0AOIZK%2BBdDZjlBHJFhKWh2SmhEjk5crXPWeq2B4beCiYLZcj2wifz0UzH37FDDTNWKduneej2g0xOBRF2eeVw%3D%3D",
          lastModifiedDate: {
            seconds: 1618170311,
            nanoseconds: 490000000
          },
          type: "ipynb"
        }
      },
      {
        user: {
          id: "WmUJgxHnAQP47QShMC6by5tKu8h1",
          thumbnailUrl:
            "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/userThumbnail?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=FNPpbSmO%2BEMlNkiUsN16Ld5VRR%2FJhhvTVYJ9vQUQqiRga37M%2BKjg9qrKDOZnOE2KVektdZGvx9QifHe1mIg3ZMFh%2B2RJJ7ohd%2FA3OWwkBk4Vm%2B61I3gHtnFS%2BZ3JrcSLRPpQ5TEGa99Sefr%2FzvcPukfisSKeYHK3NC2%2BpHah%2FNg8yBy6EGhDdtS94f9wiLZjlCVaU5m24prebOwp%2FzM1ax5kfNZ6v5KhHnGa%2BhG4HDKdTP2ydM72cK8leui%2BGxwPL3ayqXczVtkdhpWfgWTZuENMcdfgT7Yv1qfyC%2BlT2iWUwrlMgJsddZIrv52v%2Bi014zKuVH1YpryqJ8Grhrj1LA%3D%3D",
          displayName: "REPL Notes",
          name: "blog"
        },
        title: "Embed images or videos from Google Drive",
        tags: [],
        url: "drive",
        thumbnail:
          "https://drive.google.com/uc?export=view&id=1Xdll5tuxKiEeYoJqpQ0ODe1TQzHVE75J",
        description: "",
        id: "64y8yQyTExCWgdVMSLP9",
        created: { seconds: 1617550273, nanoseconds: 46000000 },
        file: {
          url:
            "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/posts/64y8yQyTExCWgdVMSLP9/post.ipynb?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=XD4oGDz8bVERq9%2BEBCWLkFxa%2FdBeVwr%2FG%2F%2BOghKM%2BOEPFowbH4FzVlLOPvwrdS4d6OX3sBzRLasq%2FFHXrC0L89om4HxxVQXW%2FVk5JUdSwPGNYZyQ9po%2FoOQuXn7L3Civ%2BrlpKaYJZml8TZyy1e%2Bia%2B%2FlhiTYDDSIEgc2MMOkQelDuqtaQLFqf%2BbR4sSvZoy4Q%2F3%2F86%2Fk%2F1EYjUKed6299gYmYWxgvhxcbUyORpmYnvI5IPqT%2BxTZL1bl0eAHYfX%2BmEsR0VyxIS0n7TX9Lwh7IN03mkJiqoxtluSZ8BVkoGEUlSY1drfYQ4XrNjLl3KF%2FwZUMu8ndUunUgyT%2FxLrcsw%3D%3D",
          lastModifiedDate: {
            seconds: 1617552681,
            nanoseconds: 947000000
          },
          type: "ipynb",
          size: 3301
        }
      },
      {
        file: {
          lastModifiedDate: {
            seconds: 1618204111,
            nanoseconds: 982000000
          },
          type: "ipynb",
          size: 8214775,
          url:
            "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/posts/dRDpY575B58w9CS6fqmN/post.ipynb?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=NZGUwDOwAx%2BgQOd7RSm13Rau4IxXUZk7QKqId1iZzSwMedaovhoT3xAwtdQmQhI5iGA5Che0fdgnf%2Fw1c82sQnFjMSGl7SvrmLg%2B2JLz3%2BCAl0RbTdgt316RvYazBhLx%2F%2BTEvXaQykxa4iEgCXktqcRbQJr9P2VjG1anQsNb7WyvDNuhr4vMPVtzMNOrbZcVqBVRQcENDwcy4tv2k2AO0e7dMmAk%2BWdgaBmSAK5w%2BLJYwHananA4xcQYrPcdwoN5cTb5boNkRBg0RJmwFm2nxkoiOC2%2FXKe7u7JKG2Jv1IFDgkOtd4PQYaR5QK6W62k48Cq72E4F4f%2F5AYgytcG5ZQ%3D%3D"
        },
        tags: ["REPL Notes"],
        thumbnail:
          "https://firebasestorage.googleapis.com/v0/b/staging-2cacb.appspot.com/o/users%2FWmUJgxHnAQP47QShMC6by5tKu8h1%2Fposts%2FdRDpY575B58w9CS6fqmN%2Fthumbnail?alt=media&token=1df99867-1b8d-4f50-a3b8-583b0ec7bc6e",
        id: "dRDpY575B58w9CS6fqmN",
        created: { seconds: 1621736633, nanoseconds: 444000000 },
        description:
          "Learn how to embed images in your posts created from Jupyter notebooks",
        user: {
          displayName: "REPL Notes",
          thumbnailUrl:
            "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/userThumbnail?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=FNPpbSmO%2BEMlNkiUsN16Ld5VRR%2FJhhvTVYJ9vQUQqiRga37M%2BKjg9qrKDOZnOE2KVektdZGvx9QifHe1mIg3ZMFh%2B2RJJ7ohd%2FA3OWwkBk4Vm%2B61I3gHtnFS%2BZ3JrcSLRPpQ5TEGa99Sefr%2FzvcPukfisSKeYHK3NC2%2BpHah%2FNg8yBy6EGhDdtS94f9wiLZjlCVaU5m24prebOwp%2FzM1ax5kfNZ6v5KhHnGa%2BhG4HDKdTP2ydM72cK8leui%2BGxwPL3ayqXczVtkdhpWfgWTZuENMcdfgT7Yv1qfyC%2BlT2iWUwrlMgJsddZIrv52v%2Bi014zKuVH1YpryqJ8Grhrj1LA%3D%3D",
          id: "WmUJgxHnAQP47QShMC6by5tKu8h1",
          name: "blog"
        },
        url: "images",
        title: "Four ways to embed images in your blog"
      }
    ],
    id: "WmUJgxHnAQP47QShMC6by5tKu8h1",
    thumbnailUrl:
      "https://storage.googleapis.com/staging-2cacb.appspot.com/users/WmUJgxHnAQP47QShMC6by5tKu8h1/userThumbnail?GoogleAccessId=firebase-adminsdk-348nb%40staging-2cacb.iam.gserviceaccount.com&Expires=16730323200&Signature=FNPpbSmO%2BEMlNkiUsN16Ld5VRR%2FJhhvTVYJ9vQUQqiRga37M%2BKjg9qrKDOZnOE2KVektdZGvx9QifHe1mIg3ZMFh%2B2RJJ7ohd%2FA3OWwkBk4Vm%2B61I3gHtnFS%2BZ3JrcSLRPpQ5TEGa99Sefr%2FzvcPukfisSKeYHK3NC2%2BpHah%2FNg8yBy6EGhDdtS94f9wiLZjlCVaU5m24prebOwp%2FzM1ax5kfNZ6v5KhHnGa%2BhG4HDKdTP2ydM72cK8leui%2BGxwPL3ayqXczVtkdhpWfgWTZuENMcdfgT7Yv1qfyC%2BlT2iWUwrlMgJsddZIrv52v%2Bi014zKuVH1YpryqJ8Grhrj1LA%3D%3D",
    displayName: "REPL Notes",
    aboutMe: "",
    created: { seconds: 1617544922, nanoseconds: 618000000 }
  },
  authUserId: null,
  showFeedbackModal: false,
  token: null,
  currentUser: {},
  isEmailVerified: null,
  readonly: {},
  error: {
    response: {
      status: "404",
      data: {
        message: "Page Not Found"
      }
    }
  }
});

export const getters = {
  userPostUrls(state) {
    if (!state.currentUser.posts) {
      return [];
    }
    return Object.values(state.currentUser.posts).map(post => {
      return post.url;
    });
  },
  userTags(state) {
    if (!state.currentUser.posts) {
      return [];
    }
    let tagList = Object.values(state.currentUser.posts).map(post => {
      return post.tags;
    });

    return [...new Set([].concat.apply([], tagList))];
  },
  loggedIn(state) {
    return state.authUserId;
  }
};

export const actions = {
  async nuxtServerInit({ commit }, { res, req }) {
    // TODO: set siteOwner and siteOwner.posts if custom domain
    console.log(req.headers);
    if (res && res.locals && res.locals.user) {
      const {
        allClaims: claims,
        idToken: token,
        ...authUser
      } = res.locals.user;
      commit("SET_AUTH_STATE", authUser);
    }
  },

  async onAuthStateChangedAction({ commit }, { authUser }) {
    commit("SET_AUTH_STATE", authUser ? authUser : {});

    if (!authUser) {
      // remove state
      commit("SET_USER", {});
      commit("SET_TOKEN", null);
    } else {
      authUser.getIdToken(/* forceRefresh */ true).then(token => {
        this.$fire.analytics.setUserId(authUser.uid);
        commit("SET_TOKEN", token);
        commit("SET_EMAIL_VERIFIED", authUser.emailVerified);

        this.$usersCollection.doc(authUser.uid).onSnapshot(snap => {
          commit("SET_USER", snap.data() || {});
        });

        this.$readonlyCollection.doc(authUser.uid).onSnapshot(snap => {
          commit("SET_READONLY_DATA", snap.data() || {});
        });
      });
    }
  }
};

export const mutations = {
  SET_USER(state, val) {
    state.currentUser = val;
  },
  SET_AUTH_STATE(state, authUser) {
    state.authUserId = authUser.uid;
  },
  SET_TOKEN(state, val) {
    state.token = val;
  },
  SET_EMAIL_VERIFIED(state, val) {
    state.isEmailVerified = val;
  },
  SET_READONLY_DATA(state, data) {
    state.readonly = data;
  }
};
